extends layout
block content
  .container.mt-4
    // Categorias no topo, como botões
    if categorias && categorias.length
      .d-flex.flex-wrap.gap-2.justify-content-center.mb-4
        each categoria in categorias
          button.btn.btn-outline-success.categoria-btn(type='button')= categoria.nome_categoria
    else
      p.text-center.text-muted Nenhuma categoria encontrada.

    // Feed de postagens
    .row.justify-content-center
      .col-lg-7.col-md-9
        h2.mb-4.text-center.text-success Feed de Postagens
        if posts && posts.length
          each post in posts
            .card.mb-4.shadow-sm
              .card-body
                .d-flex.align-items-center.mb-2
                  img.rounded-circle.me-2(
                    src=post.foto_perfil || '/images/default-avatar.png',
                    alt=post.nome_usuario || 'Usuário',
                    width='48',
                    height='48',
                    style="border:2px solid #eee;"
                  )
                  .flex-grow-1
                    if post.nome_usuario
                      span.fw-bold= post.nome_usuario
                    if post.verificado
                      img.ms-1(src='/images/verificado.png', alt='Verificado', title='Verificado', height='18')
                    br
                    if post.data_criacao
                      span.text-muted.small= post.data_criacao.toLocaleString ? post.data_criacao.toLocaleString() : post.data_criacao
                    if post.nome_categoria
                      br
                      span.badge.rounded-pill.text-bg-success.ms-1(
                        style="background:rgba(0,180,120,0.13); color:#009e60;"
                      )= post.nome_categoria
                .mt-2
                  if post.tipo_postagem === 'text' && post.conteudo
                    p.mb-2= post.conteudo
                  else if post.tipo_postagem === 'photo' && post.url_midia
                    img.img-fluid.rounded.mb-2(src=post.url_midia, alt='Foto')
                  else if post.tipo_postagem === 'video' && post.url_midia && post.tipo_midia
                    video.w-100.rounded.mb-2(controls)
                      source(src=post.url_midia, type=post.tipo_midia)
                      | Seu navegador não suporta vídeo.
                  else if post.tipo_postagem === 'article' && post.conteudo
                    h6.text-success.mb-1 Artigo Científico
                    p.mb-2= post.conteudo
                .d-flex.justify-content-between.align-items-center.mt-3
                  span
                    img.me-1(src='/images/like.png', alt='Curtidas', height='20')
                    | #{post.total_curtidas || 0}
                  span
                    img.me-1(src='/images/comment.png', alt='Comentários', height='20')
                    | #{post.total_comentarios || 0}
                  span
                    img.me-1(src='/images/share.png', alt='Compartilhamentos', height='20')
                    | #{post.total_compartilhamentos || 0}
        else
          p.text-center.text-muted.mt-5 Nenhuma postagem encontrada.

        // Configurações e perfil (aparece embaixo no mobile)
        .card.shadow-sm.mt-5.mb-4.d-block.d-md-none(style="background:rgba(0,180,120,0.13); border:none;")
          .card-body.p-3.text-center
            if usuario
              img.rounded-circle.mb-2(
                src=usuario.foto_perfil || '/images/default-avatar.png',
                alt=usuario.nome_usuario || 'Usuário',
                width='56',
                height='56',
                style="border:2px solid #eee;"
              )
              if usuario.nome_usuario
                h6.mb-1= usuario.nome_usuario
              a.btn.btn-outline-success.btn-sm.mt-2(href='/usuarios/' + usuario.id_usuario) Meu Perfil
              br
              a.btn.btn-outline-secondary.btn-sm.mt-2(href='/settings') Configurações
            else
              p.text-muted Faça login para acessar seu perfil.

  // Configurações e perfil (aparece na lateral só em telas grandes)
  if usuario
    .position-fixed.top-50.end-0.translate-middle-y.d-none.d-md-block(style="width:220px; z-index:2; right:24px;")
      .card.shadow-sm(style="background:rgba(0,180,120,0.13); border:none;")
        .card-body.p-3.text-center
          img.rounded-circle.mb-2(
            src=usuario.foto_perfil || '/images/default-avatar.png',
            alt=usuario.nome_usuario || 'Usuário',
            width='56',
            height='56',
            style="border:2px solid #eee;"
          )
          if usuario.nome_usuario
            h6.mb-1= usuario.nome_usuario
          a.btn.btn-outline-success.btn-sm.mt-2(href='/usuarios/' + usuario.id_usuario) Meu Perfil
          br
          a.btn.btn-outline-secondary.btn-sm.mt-2(href='/settings') Configurações
