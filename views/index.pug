extends layout

block styles
  link(rel="stylesheet", href="/stylesheets/index.css")

block content
  .container-fluid.mt-4
    // CATEGORIAS NO TOPO
    .categorias-topo.bg-white.rounded-3.shadow-sm.p-3.mb-3
      if categorias && categorias.length
        h6.text-success.mb-3.text-center Categorias
        .d-flex.mb-2#categorias-linha
        if categorias.length > 0
          a#link-visualizar-todas-categorias(href="javascript:void(0)", style="color:#009e60; text-decoration:underline; font-weight:500; margin-left:8px;") Visualizar todas
        .categorias-side-panel.position-fixed.top-0.start-0.bg-white.shadow-lg.p-3(style="display:none;z-index:999;height:100vh;width:320px;overflow-y:auto;")
          .d-flex.justify-content-between.align-items-center.mb-3
            h5.mb-0.text-success Categorias
            a#link-fechar-categorias(href="javascript:void(0)", style="color:#d9534f; text-decoration:underline; font-weight:500;") Fechar
          each categoria in categorias
            button.categoria-btn.mb-2.acao-restrita(type='button')= categoria.nome_categoria
      else
        p.text-center.text-muted Nenhuma categoria encontrada.

    if tags && tags.length
      .tags-topo.bg-white.rounded-3.shadow-sm.p-3.mb-3
        h6.text-primary.mb-3.text-center Tags Populares
        .d-flex.mb-2#tags-linha
        if tags.length > 0
          a#link-visualizar-todas-tags(href="javascript:void(0)", style="color:#007bff; text-decoration:underline; font-weight:500; margin-left:8px;") Visualizar todas
        .tags-side-panel.position-fixed.top-0.start-0.bg-white.shadow-lg.p-3(style="display:none;z-index:999;height:100vh;width:320px;overflow-y:auto;")
          .d-flex.justify-content-between.align-items-center.mb-3
            h5.mb-0.text-primary Tags
            a#link-fechar-tags(href="javascript:void(0)", style="color:#d9534f; text-decoration:underline; font-weight:500;") Fechar
          each tag in tags
            - const traducao = tag.traducoes && tag.traducoes[0];
            button.tag-btn.mb-2.acao-restrita(type='button', data-href=`/tag/${tag.nome_tag}`)= traducao ? traducao.nome_tag : (tag.nome_tag || tag.nome)

    // FEED DE POSTAGENS
    .row.justify-content-center
      .col-12.col-md-10.col-lg-8
        h2.mb-3.text-success.text-center Feed de Postagens
        if posts && posts.length
          - let count = 0;
          each post, i in posts
            .card.mb-2.shadow-sm
              .card-body.p-3
                .d-flex.align-items-center.mb-2
                  // Foto do usuário - clicável para o perfil
                  a(href=`/usuarios/${post.id_autor || ''}`)
                    img.rounded-circle.me-2(
                      src=post.foto_perfil || '/images/default-avatar.png',
                      alt=post.nome_usuario || 'Usuário',
                      width='48',
                      height='48',
                      style="border:2px solid #eee; cursor:pointer;"
                    )
                .flex-grow-1
                  if post.nome_usuario
                    span.fw-bold= post.nome_usuario
                  if post.verificado
                    img.ms-1(src='/images/verificado.png', alt='Verificado', title='Verificado', height='18')
                  br
                  if post.data_criacao
                    span.text-muted.small= post.data_criacao.toLocaleString ? post.data_criacao.toLocaleString() : post.data_criacao
                  if post.nome_categoria
                    br
                    span.badge.rounded-pill.text-bg-success.ms-1(
                      style="background:rgba(0,180,120,0.13); color:#009e60;"
                    )= post.nome_categoria
                .mt-2
                  if post.tipo_postagem === 'text' && post.conteudo
                    // Conteúdo do post
                    p.mb-2= post.conteudo
                  else if post.tipo_postagem === 'photo' && post.url_midia
                    // Foto do post - clicável para detalhes
                    a(href=`/postagens/${post.id_postagem || ''}`)
                      img.img-fluid.rounded.mb-2(
                        src=post.url_midia,
                        alt='Foto',
                        style="cursor:pointer;"
                      )
                  else if post.tipo_postagem === 'video' && post.url_midia && post.tipo_midia
                    // Vídeo do post - clicável para detalhes
                    a(href=`/postagens/${post.id_postagem || ''}`)
                      video.w-100.rounded.mb-2(controls, style="cursor:pointer;")
                        source(src=post.url_midia, type=post.tipo_midia)
                        | Seu navegador não suporta vídeo.
                  else if post.tipo_postagem === 'article' && post.conteudo
                    h6.text-success.mb-1 Artigo Científico
                    p.mb-2= post.conteudo
                .d-flex.justify-content-between.align-items-center.mt-2
                  span
                    button.acao-restrita.btn.btn-outline-success.btn-sm(
                      type="button"
                      title="Curtir"
                    )
                      img.me-1(src='/images/like.png', alt='Curtidas', height='20', style="cursor:pointer;")
                      | #{post.total_curtidas || 0}
                  span
                    button.acao-restrita.btn.btn-outline-primary.btn-sm(
                      type="button"
                      title="Comentar"
                    )
                      img.me-1(src='/images/comment.png', alt='Comentários', height='20', style="cursor:pointer;")
                      | #{post.total_comentarios || 0}
                  span
                    button.acao-restrita.btn.btn-outline-secondary.btn-sm(
                      type="button"
                      title="Compartilhar"
                    )
                      img.me-1(src='/images/share.png', alt='Compartilhamentos', height='20', style="cursor:pointer;")
                      | #{post.total_compartilhamentos || 0}
            - count++;
            if count % 15 === 0 && grupos && grupos.length
              .row.align-items-center.mb-3
                .col-auto.p-0
                  .d-flex.align-items-center#grupos-feed-linha(data-grupos=JSON.stringify(grupos))
                .col.p-0
                  button#link-visualizar-mais-grupos-feed.btn.btn-outline-primary.btn-sm.ms-2 Visualizar grupos disponíveis
      // Painel lateral de grupos (inicialmente oculto)
      .grupos-feed-panel.position-fixed.top-0.end-0.bg-white.shadow-lg.p-3(style="display:none;z-index:999;height:100vh;width:320px;overflow-y:auto;right:0;")
        .d-flex.justify-content-between.align-items-center.mb-3
          h5.mb-0.text-primary Todos os Grupos
          button#link-fechar-grupos-feed.btn.btn-outline-danger.btn-sm Fechar
        .d-flex.flex-wrap#grupos-feed-panel-list
          // Todos os grupos renderizados pelo JS
          each grupo in grupos
            button.grupo-btn.mb-2.acao-restrita(type='button')= grupo.nome_grupo

  block scripts
    script(src="/javascripts/index.js")
