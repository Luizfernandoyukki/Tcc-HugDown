extends layout

block styles
  link(rel="stylesheet", href="/stylesheets/index.css")

block content
  .container-fluid.mt-4
    // CATEGORIAS NO TOPO (rolagem horizontal com setas)
    .categorias-topo.bg-white.rounded-3.shadow-sm.p-3.mb-3
      if categorias && categorias.length
        h6.text-success.mb-3.text-center Categorias
        .categorias-scroll-wrapper.position-relative
          button.categorias-arrow.left(type="button", aria-label="Anterior") &lt;
          .categorias-scroll
            each categoria in categorias
              button.btn.btn-outline-success.categoria-btn(type='button')= categoria.nome_categoria
          button.categorias-arrow.right(type="button", aria-label="Próxima") &gt;
      else
        p.text-center.text-muted Nenhuma categoria encontrada.

    // TAGS (rolagem horizontal com setas)
    if tags && tags.length
      .tags-scroll-wrapper.position-relative.mb-4
        button.tags-arrow.left(type="button", aria-label="Anterior") &lt;
        .tags-scroll
          each tag in tags
            - const traducao = tag.traducoes && tag.traducoes[0];
            a.btn.btn-outline-primary.btn-sm.tag-btn(href=`/tag/${tag.slug || tag.id}`)= traducao ? traducao.nome_tag : (tag.nome_tag || tag.nome)
        button.tags-arrow.right(type="button", aria-label="Próxima") &gt;
    else
      //- Se quiser, pode exibir uma mensagem ou nada

    // FEED DE POSTAGENS
    .row.justify-content-center
      .col-12.col-md-10.col-lg-8
        h2.mb-3.text-success.text-center Feed de Postagens
        if posts && posts.length
          - let count = 0;
          each post, i in posts
            .card.mb-2.shadow-sm
              .card-body.p-3
                .d-flex.align-items-center.mb-2
                  img.rounded-circle.me-2(
                    src=post.foto_perfil || '/images/default-avatar.png',
                    alt=post.nome_usuario || 'Usuário',
                    width='48',
                    height='48',
                    style="border:2px solid #eee;"
                  )
                  .flex-grow-1
                    if post.nome_usuario
                      span.fw-bold= post.nome_usuario
                    if post.verificado
                      img.ms-1(src='/images/verificado.png', alt='Verificado', title='Verificado', height='18')
                    br
                    if post.data_criacao
                      span.text-muted.small= post.data_criacao.toLocaleString ? post.data_criacao.toLocaleString() : post.data_criacao
                    if post.nome_categoria
                      br
                      span.badge.rounded-pill.text-bg-success.ms-1(
                        style="background:rgba(0,180,120,0.13); color:#009e60;"
                      )= post.nome_categoria
                .mt-2
                  if post.tipo_postagem === 'text' && post.conteudo
                    p.mb-2= post.conteudo
                  else if post.tipo_postagem === 'photo' && post.url_midia
                    img.img-fluid.rounded.mb-2(src=post.url_midia, alt='Foto')
                  else if post.tipo_postagem === 'video' && post.url_midia && post.tipo_midia
                    video.w-100.rounded.mb-2(controls)
                      source(src=post.url_midia, type=post.tipo_midia)
                      | Seu navegador não suporta vídeo.
                  else if post.tipo_postagem === 'article' && post.conteudo
                    h6.text-success.mb-1 Artigo Científico
                    p.mb-2= post.conteudo
                .d-flex.justify-content-between.align-items-center.mt-2
                  span
                    img.me-1(src='/images/like.png', alt='Curtidas', height='20')
                    | #{post.total_curtidas || 0}
                  span
                    img.me-1(src='/images/comment.png', alt='Comentários', height='20')
                    | #{post.total_comentarios || 0}
                  span
                    img.me-1(src='/images/share.png', alt='Compartilhamentos', height='20')
                    | #{post.total_compartilhamentos || 0}
            - count++;
            if count % 20 === 0 && grupos && grupos.length
              .grupos-populares-box.my-4.p-3.bg-light.rounded-3.shadow
                h5.text-primary.mb-3 Grupos Populares
                .grupos-carousel-container.position-relative.overflow-hidden.mx-auto(style="width:420px;max-width:100%;height:110px;")
                  .grupos-carousel.d-flex.flex-nowrap.align-items-center(style="transition: transform 0.6s; will-change: transform;")
                    each grupo in grupos
                      a(href=`/grupos/${grupo.id_grupo}`, class="text-decoration-none mx-2")
                        .grupo-card.p-2.bg-white.rounded-2.shadow-sm.text-center(style="min-width:130px;max-width:180px;")
                          if grupo.foto_grupo
                            img.mb-2.rounded-circle(src=grupo.foto_grupo, alt=grupo.nome_grupo, width="64", height="64")
                          else
                            img.mb-2.rounded-circle(src="/images/default-group.png", alt="Grupo", width="64", height="64")
                          div.fw-bold= grupo.nome_grupo
        else
          p.text-center.text-muted.mt-5 Nenhuma postagem encontrada.

    // Configurações e perfil (aparece embaixo no mobile)
    .card.shadow-sm.mt-5.mb-4.d-block.d-md-none(style="background:rgba(0,180,120,0.13); border:none;")
      .card-body.p-3.text-center
        if usuario
          img.rounded-circle.mb-2(
            src=usuario.foto_perfil || '/images/default-avatar.png',
            alt=usuario.nome_usuario || 'Usuário',
            width='56',
            height='56',
            style="border:2px solid #eee;"
          )
          if usuario.nome_usuario
            h6.mb-1= usuario.nome_usuario
          a.btn.btn-outline-success.btn-sm.mt-2(href='/usuarios/' + usuario.id_usuario) Meu Perfil
          br
          a.btn.btn-outline-secondary.btn-sm.mt-2(href='/settings') Configurações
        else
          p.text-muted Faça login para acessar seu perfil.

  // Configurações e perfil (aparece na lateral só em telas grandes)
  if usuario
    .position-fixed.top-50.end-0.translate-middle-y.d-none.d-md-block(style="width:220px; z-index:2; right:24px;")
      .card.shadow-sm(style="background:rgba(0,180,120,0.13); border:none;")
        .card-body.p-3.text-center
          img.rounded-circle.mb-2(
            src=usuario.foto_perfil || '/images/default-avatar.png',
            alt=usuario.nome_usuario || 'Usuário',
            width='56',
            height='56',
            style="border:2px solid #eee;"
          )
          if usuario.nome_usuario
            h6.mb-1= usuario.nome_usuario
          a.btn.btn-outline-success.btn-sm.mt-2(href='/usuarios/' + usuario.id_usuario) Meu Perfil
          br
          a.btn.btn-outline-secondary.btn-sm.mt-2(href='/settings') Configurações
block scripts
  script(src="/javascripts/index.js")